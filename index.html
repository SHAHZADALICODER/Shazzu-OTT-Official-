<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shazzu</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>

    <style>
        /* ============ SAME STYLES AS BEFORE ============ */
        :root {
            --dark-blue-base: #0D144A;
            --dark-blue-accent: #172054;
            --light-text: #E0E0FF;
            --new-badge-color: #FF5252;
            --live-badge-color: #38C76D;
        }
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--dark-blue-base);
            color: var(--light-text);
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            line-height: 1.6;
        }
        h1 { text-align: center; font-size: 2.5em; margin-bottom: 40px; color: var(--light-text); }
        .featured-film, .film-item {
            position: relative;
            background-color: var(--dark-blue-accent);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
            cursor: pointer;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }
        .featured-film:hover, .film-item:hover { transform: scale(1.01); box-shadow: 0 12px 24px rgba(0,0,0,0.6); }
        .featured-film img, .film-item img { width: 100%; display: block; border-radius: 12px; }
        .featured-title-overlay, .film-title-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 20px;
            background: linear-gradient(to top, rgba(0,0,0,0.9), rgba(0,0,0,0));
            text-align: center;
        }
        .featured-title { margin: 0; font-size: 2em; font-weight: 600; color: var(--light-text); }
        .film-title { margin: 0; font-size: 1.3em; font-weight: 600; color: var(--light-text); }
        .badge { position: absolute; top: 10px; right: 10px; font-size: 0.8em; font-weight: 600; padding: 4px 8px; border-radius: 4px; z-index: 10; color: white; animation: glowing 1.5s infinite ease-in-out; }
        .featured-film .badge { top: 20px; right: 20px; font-size: 1em; padding: 8px 12px; border-radius: 8px; }
        .badge.new { background-color: var(--new-badge-color); }
        .badge.coming-soon { background-color: var(--new-badge-color); }
        .badge.live { background-color: var(--live-badge-color); }
        @keyframes glowing { 0%,100%{box-shadow:0 0 5px currentColor;}50%{box-shadow:0 0 20px currentColor,0 0 10px currentColor;} }
        .grid-separator { text-align:center; margin-bottom:30px; position:relative; }
        .grid-separator h2 { margin:0; font-size:1.8em; font-weight:600; display:inline-block; padding:0 20px; background-color: var(--dark-blue-base); z-index:2; position: relative; }
        .grid-separator::before { content:''; position:absolute; top:50%; left:0; right:0; height:2px; background-color: var(--dark-blue-accent); z-index:1; }
        .film-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(280px,1fr)); gap:25px; padding:0; list-style:none; }
        footer { background-color: var(--dark-blue-accent); color: var(--light-text); text-align:center; padding:30px 20px; margin-top:50px; }
        footer p { margin:5px 0; font-size:0.9em; }
    </style>
</head>

<body>
    <header>
        <h1>Shazzu</h1>
    </header>

    <section id="featured-film-container">
        <p style="text-align:center;">Loading featured film...</p>
    </section>
    
    <div class="grid-separator"><h2>Our Collection</h2></div>

    <main class="film-grid" id="films-container">
        <p style="text-align:center;">Loading films from Firestore...</p>
    </main>

    <footer>
        <p>This is the official platform of Shazzu.</p>
        <p>Founded by Shahzad Ali.</p>
    </footer>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD4tIqVSUIRRKORyf4H34hTu1pkMxFxge0",
            authDomain: "shazzuott.firebaseapp.com",
            projectId: "shazzuott",
            storageBucket: "shazzuott.firebasestorage.app",
            messagingSenderId: "609756366225",
            appId: "1:609756366225:web:30610e75ed517c040ac630"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const filmsContainer = document.getElementById('films-container');
        const featuredFilmContainer = document.getElementById('featured-film-container');

        function createFilmItem(filmData, docId, isNew=false){
            const filmItem = document.createElement('div');
            filmItem.classList.add('film-item');

            const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
            const match = filmData.LINK.match(regex);
            const videoId = match ? match[1] : null;
            const thumbnailUrl = videoId ? `https://img.youtube.com/vi/${videoId}/mqdefault.jpg` : 'https://via.placeholder.com/280x160?text=Invalid+Link';

            filmItem.innerHTML = `
                ${isNew ? '<span class="badge new">New</span>' : ''}
                <img src="${thumbnailUrl}" alt="${filmData.TITLE}">
                <div class="film-title-overlay">
                    <h2 class="film-title">${filmData.TITLE}</h2>
                </div>
            `;

            filmItem.addEventListener('click', ()=>{
                window.location.href = `preview.html?id=${docId}`;
            });

            return filmItem;
        }

        function createFeaturedFilm(filmData, docId){
            const featuredFilm = document.createElement('div');
            featuredFilm.classList.add('featured-film');

            const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
            const match = filmData.LINK.match(regex);
            const videoId = match ? match[1] : null;
            const thumbnailUrl = videoId ? `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg` : 'https://via.placeholder.com/1280x720?text=Invalid+Link';
            const badgeText = filmData.LIVE === "NO" ? "Coming Soon" : "Live";
            const badgeClass = filmData.LIVE === "NO" ? "coming-soon" : "live";

            featuredFilm.innerHTML = `
                <span class="badge ${badgeClass}">${badgeText}</span>
                <img src="${thumbnailUrl}" alt="${filmData.TITLE}">
                <div class="featured-title-overlay">
                    <h2 class="featured-title">${filmData.TITLE}</h2>
                </div>
            `;

            featuredFilm.addEventListener('click', ()=>{
                window.location.href = `preview.html?id=${docId}`;
            });

            return featuredFilm;
        }

        // Featured film
        db.collection("HEAD").doc("LATEST").get().then(doc=>{
            featuredFilmContainer.innerHTML = '';
            if(doc.exists){
                const filmData = doc.data();
                if(filmData.ENABLE){
                    const featuredItem = createFeaturedFilm(filmData, "LATEST");
                    featuredFilmContainer.appendChild(featuredItem);
                }
            }
        }).catch(err=>{console.error("Error fetching featured:",err); featuredFilmContainer.innerHTML='<p style="text-align:center;">Error loading featured film.</p>'; });

        // Films grid
        db.collection("FILMS").get().then(querySnapshot=>{
            filmsContainer.innerHTML='';
            if(querySnapshot.empty){
                filmsContainer.innerHTML='<p style="text-align:center;">No films found.</p>';
                return;
            }
            const docs = querySnapshot.docs.reverse();
            let isFirst=true;
            docs.forEach(doc=>{
                const filmData = doc.data();
                const filmItem = createFilmItem(filmData, doc.id, isFirst);
                filmsContainer.appendChild(filmItem);
                isFirst=false;
            });
        }).catch(err=>{
            console.error("Error fetching films:", err);
            filmsContainer.innerHTML='<p style="text-align:center;">Error loading films. Please try again later.</p>';
        });
    </script>
</body>
</html>
